import{j as s,b as m,g as P,r as l}from"./index-Bm4W7kcw.js";import{A as v,d as M,e as C,M as T,g as E,F as A,L as I}from"./Layout-D9T89pnA.js";import{C as L}from"./FollowButton-CZO9unpF.js";import{u as g}from"./useAuth-2B9FPw-q.js";import{F as O}from"./Feed-DBOQaBDA.js";import{u as k,a as F,P as S}from"./PublishModal-dZ9h-lD9.js";import"./CodeBlock-C7OKY8nB.js";import"./posts-IdGjEV-3.js";import"./users-DvomXxAS.js";const R=[{type:"MOMENT",icon:T,label:"动态",color:"text-amber-600 dark:text-amber-400"},{type:"SNIPPET",icon:E,label:"代码",color:"text-blue-600 dark:text-blue-400"},{type:"ARTICLE",icon:A,label:"文章",color:"text-green-600 dark:text-green-400"}];function $({onCompose:a}){const{user:e}=g();return e?s.jsxs(L,{className:"border-gray-200 rounded p-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(v,{className:"h-9 w-9",children:[s.jsx(M,{src:e.avatarUrl||void 0,alt:e.username}),s.jsx(C,{className:"text-xs font-medium",children:e.username.slice(0,2).toUpperCase()})]}),s.jsx("button",{type:"button",onClick:()=>a("MOMENT"),className:m("flex-1 rounded bg-secondary px-3 py-2","text-left text-sm text-muted-foreground","transition-colors duration-150","hover:bg-accent hover:text-foreground","focus:outline-none focus:ring-1 focus:ring-ring"),children:"分享点什么..."})]}),s.jsx("div",{className:"mt-3 flex items-center justify-end gap-1 border-t border-border pt-3",children:R.map(({type:n,icon:r,label:o,color:i})=>s.jsxs("button",{type:"button",onClick:()=>a(n),className:m("flex items-center gap-1.5 rounded px-3 py-1.5","text-sm transition-colors duration-150",i,"hover:bg-accent"),children:[s.jsx(r,{className:"h-4 w-4"}),s.jsx("span",{children:o})]},n))})]}):null}function K(){const{user:a}=g(),e=P({from:"/"}),[n,r]=l.useState(!1),[o,i]=l.useState("MOMENT"),{data:p,isLoading:d,isFetchingNextPage:x,hasNextPage:h,fetchNextPage:y,error:u}=k({tag:e.tag,type:e.type}),c=F(),b=l.useMemo(()=>p?.pages.flatMap(t=>t.content)??[],[p]),f=t=>{i(t),r(!0)},N=async t=>{try{await c.mutateAsync({type:t.type,title:t.title||void 0,content:t.content,language:t.language||void 0,coverImage:t.coverImage||void 0,images:t.images&&t.images.length>0?t.images:void 0,tags:t.tags.length>0?t.tags:void 0}),r(!1)}catch{}},j=()=>e.tag&&e.type?`没有找到标签为 "${e.tag}" 且类型为 "${e.type}" 的内容`:e.tag?`没有找到标签为 "${e.tag}" 的内容`:e.type?`没有找到类型为 "${{SNIPPET:"代码片段",ARTICLE:"文章",MOMENT:"动态"}[e.type]}" 的内容`:"还没有任何内容，成为第一个发布者吧！";return s.jsxs(I,{children:[s.jsxs("div",{className:"space-y-4",children:[(e.tag||e.type)&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx("span",{children:"筛选:"}),e.tag&&s.jsxs("span",{className:"px-2 py-0.5 bg-secondary rounded-full",children:["#",e.tag]}),e.type&&s.jsxs("span",{className:"px-2 py-0.5 bg-secondary rounded-full",children:[e.type==="SNIPPET"&&"代码片段",e.type==="ARTICLE"&&"文章",e.type==="MOMENT"&&"动态"]})]}),a&&s.jsx($,{onCompose:f}),u&&s.jsxs("div",{className:"p-4 text-center text-red-600 bg-red-50 rounded-lg",children:["加载失败：",u.message]}),s.jsx(O,{posts:b,isLoading:d,isFetchingNextPage:x,hasNextPage:h,fetchNextPage:y,emptyMessage:j()})]}),s.jsx(S,{open:n,onOpenChange:r,initialType:o,onPublish:N,isPublishing:c.isPending,error:c.error?.message})]})}export{K as component};
