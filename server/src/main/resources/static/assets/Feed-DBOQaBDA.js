import{c as j,j as e,b as m,n as h,r as u,L as g,e as p}from"./index-Bm4W7kcw.js";import{A as v,d as N,e as b,M as y,F as w,g as C}from"./Layout-D9T89pnA.js";import{C as f,F as I}from"./FollowButton-CZO9unpF.js";import{u as M}from"./useAuth-2B9FPw-q.js";import{I as k,C as T}from"./CodeBlock-C7OKY8nB.js";const S=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],A=j("inbox",S);function E({title:s="暂无内容",description:n="成为第一个分享的人吧！",className:a}){return e.jsx(f,{className:m("py-12 text-center",a),children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-muted",children:e.jsx(A,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n})]})]})})}function F({title:s,summary:n,coverImage:a}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-base font-semibold leading-snug line-clamp-2",children:s}),e.jsxs("div",{className:m("flex gap-3",a&&"items-start"),children:[e.jsx("div",{className:"flex-1 min-w-0",children:n&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed line-clamp-3",children:n})}),a&&e.jsx("div",{className:"shrink-0",children:e.jsx("img",{src:h(a),alt:s,className:"h-16 w-24 rounded object-cover border border-border"})})]})]})}function P({content:s,images:n}){const a=n?.length||0,[d,i]=u.useState(null);return e.jsxs("div",{className:"py-1 space-y-3",children:[e.jsx("p",{className:"text-[15px] leading-relaxed whitespace-pre-wrap text-foreground/90 line-clamp-8",children:s}),a>0&&e.jsx("div",{className:m("grid gap-1.5 max-w-[300px]",a===1?"grid-cols-1":a===2?"grid-cols-2":"grid-cols-3"),children:n?.slice(0,9).map((r,c)=>{const o=h(r);return e.jsx("button",{type:"button",className:"relative overflow-hidden rounded bg-muted aspect-square cursor-pointer p-0 border-0",onClick:()=>i(c),children:e.jsx("img",{src:o,alt:`图片 ${c+1}`,className:"absolute inset-0 h-full w-full object-cover",loading:"lazy"})},r)})}),e.jsx(k,{images:n??[],open:d!==null,initialIndex:d??0,onOpenChange:r=>i(r?0:null)})]})}function L(s){const n=new Date(s),d=new Date().getTime()-n.getTime(),i=Math.floor(d/1e3),r=Math.floor(i/60),c=Math.floor(r/60),o=Math.floor(c/24);return i<60?"刚刚":r<60?`${r} 分钟前`:c<24?`${c} 小时前`:o<7?`${o} 天前`:n.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}function R({userId:s,username:n,avatarUrl:a,timestamp:d,size:i="md",className:r,asLink:c=!0}){const o=i==="sm"?"h-6 w-6":"h-8 w-8",l=e.jsxs(e.Fragment,{children:[e.jsxs(v,{className:o,children:[e.jsx(N,{src:a||void 0,alt:n}),e.jsx(b,{className:"text-xs font-medium",children:n.slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-sm",children:n}),d&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground/50",children:"·"}),e.jsx("span",{className:"text-muted-foreground text-xs",children:L(d)})]})]})]});return c?e.jsx(g,{to:"/users/$userId",params:{userId:String(s)},className:m("flex items-center gap-1.5",r),onClick:t=>t.stopPropagation(),children:l}):e.jsx("div",{className:m("flex items-center gap-1.5",r),children:l})}function U({title:s,content:n,language:a}){return e.jsxs("div",{className:"space-y-2",children:[s&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsx(T,{code:n,language:a||"plaintext",maxLines:6})]})}const O={SNIPPET:{icon:C,color:"text-blue-600",label:"代码片段"},ARTICLE:{icon:w,color:"text-green-600",label:"文章"},MOMENT:{icon:y,color:"text-amber-600",label:"动态"}};function $({post:s,className:n}){const a=O[s.type],d=a.icon,i=p(),{user:r}=M(),o=!(r?.id===s.user.id),l=(t,x)=>{t.preventDefault(),t.stopPropagation(),i({to:"/",search:{tag:x}})};return e.jsx(g,{to:"/posts/$id",params:{id:String(s.id)},className:"block",children:e.jsxs(f,{className:m("p-4 cursor-pointer",n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{userId:s.user.id,username:s.user.username,avatarUrl:s.user.avatarUrl,timestamp:s.createdAt,asLink:!1}),o&&e.jsx(I,{userId:s.user.id,size:"sm"})]}),e.jsxs("div",{className:m("flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium","bg-gray-100 dark:bg-gray-800",a.color),title:a.label,children:[e.jsx(d,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:a.label})]})]}),e.jsxs("div",{className:"mb-3",children:[s.type==="SNIPPET"&&e.jsx(U,{title:s.title,content:s.content,language:s.language}),s.type==="ARTICLE"&&e.jsx(F,{title:s.title||"无标题",summary:s.summary,coverImage:s.coverImage}),s.type==="MOMENT"&&e.jsx(P,{content:s.content,images:s.images})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.tags.map(t=>e.jsxs("button",{type:"button",onClick:x=>l(x,t.name),className:m("inline-flex items-center gap-0.5 px-2 py-0.5 rounded","bg-gray-100 dark:bg-gray-800 text-muted-foreground text-xs","hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-foreground","transition-colors duration-150"),children:[e.jsx("span",{className:"opacity-50",children:"#"}),e.jsx("span",{children:t.name})]},t.id))})]})})}function z({className:s}){return e.jsxs(f,{className:m("p-5",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"h-9 w-9 rounded-full bg-secondary/80 animate-pulse"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"h-3.5 w-24 rounded bg-secondary/80 animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-secondary/60 animate-pulse"})]})]}),e.jsx("div",{className:"h-6 w-16 rounded-md bg-secondary/60 animate-pulse"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"h-4 w-4/5 rounded bg-secondary/80 animate-pulse"}),e.jsx("div",{className:"h-24 w-full rounded-lg bg-secondary/60 animate-pulse"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-6 w-14 rounded-md bg-secondary/60 animate-pulse"}),e.jsx("div",{className:"h-6 w-18 rounded-md bg-secondary/60 animate-pulse"}),e.jsx("div",{className:"h-6 w-12 rounded-md bg-secondary/60 animate-pulse"})]})]})}function G({posts:s,isLoading:n=!1,isFetchingNextPage:a=!1,hasNextPage:d=!1,fetchNextPage:i,emptyMessage:r}){const c=u.useRef(null),o=u.useRef(void 0);return o.current=l=>{const[t]=l;t.isIntersecting&&d&&!a&&i&&i()},u.useEffect(()=>{const l=c.current;if(!l)return;const t=new IntersectionObserver(x=>o.current?.(x),{threshold:.1});return t.observe(l),()=>t.disconnect()},[]),n?e.jsx("div",{className:"space-y-5",children:Array.from({length:3}).map((l,t)=>e.jsx(z,{},t))}):s.length===0?e.jsx(E,{description:r}):e.jsxs("div",{className:"space-y-5",children:[s.map(l=>e.jsx($,{post:l},l.id)),e.jsx("div",{ref:c,className:"h-4"}),a&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"h-6 w-6 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]})}export{G as F};
